<include file= './application/Home/View/Common/header.html' />
<link rel="stylesheet" type="text/css" href="{$APP_PUBLIC_URL}css/personalcenter.css">
<div id="personalCenterBox">
        <section class="personal-body">
        	<div class="personal-top">
            	<a class="set" id="setBtn">设置</a>
                <div class="img">
                	<span><img src="{$userInfo.face.face_big}"/></span>
                    <label>{$userInfo.name}</label>
                </div>
                <p>{$userInfo.classes_name}</p>
            </div>
        </section>
    <!--问题描述-->
    <section id="entryDescription" class="entry-description bs2">
        <p>描述问题进行登记吧...</p>
        <i></i>
    </section>

    <div id="select" class="select">
        <ul>
            <li class="selected">当前维修任务</li>
            <li>我的维修记录</li>
        </ul>
    </div>

    <!----维修记录--->
	<section class="record-body">
        <empty name="records">
            <p style="margin-top:20px;text-align: center;">暂无维修记录</p>
        <else />
            <volist name="records" id="record">

                <!--State:状态开始-->
                <div class="state">
                    <header>

                        <label>{$record.state.node_info}</label>
                    </header>

                    <section>
                        <span><img src="{$record['images']['url_sm']}"/></span>
                        <div class="description">
                            <p>
                                <label>问题描述：</label>
                                {$record.problem_desc}
                            </p>
                        </div>
                        <footer>
                            <p>型号：{$record.computer_name}</p>
                            <p>{$record.start_time}</p>
                        </footer>
                    </section>
                    <footer>
                        <p>维修人：陶炜</p>
                        {:W('RepairRecordMange/showButton',array(array('repair_record_id'=>$record.id,'repair_record_uid'=>$record.uid)))}
                    </footer>
                </div>
                <!--State:状态结束-->
            </volist>
        </empty>
	</section>
</div>

<div class="messCount">消息<if condition="($messCount neq 0)"><span id="messCount">{$messCount}</span></if></div>
{:W('PersonData/personData')}
<include file= './application/Home/View/Common/footer.html' />
<script type="text/javascript">
    var JmessCount = $('#messCount');
    $(function () {
        //点击设置按钮
        $('#setBtn').click(function () {
            setHeader("编辑个人资料");
            $('#dataBox').show('fast');
            $('#personalCenterBox').hide();
            setBackFun(function(){
                $('#dataBox').hide();
                $('#personalCenterBox').show('fast');
                $('#header>button').remove();
                $('#header').prepend('<a href="#" class="hidden-text" title="后退">后退</a>');
            });
        });
        //点击开始登记按钮
        $('#entryDescription').click(function(){
            window.location = "{$RegisterUrl}";
        });
        //获取未读的消息总数
        setInterval(function(){
            ajaxRequest("{$header['messCount']}",function(data){
                if(data.messCount == 0){
                    JmessCount.hide();
                }else{
                    JmessCount.show();
                    JmessCount.html(data.messCount);
                }
            },'json')
        },5000);
    });
</script>